# This is a basic workflow to help you get started with Actions

name: YouTube Shorts Upload

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  # Scheduled YouTube upload jobs
  schedule:
    - cron: '0 10 * * *'
    - cron: '0 12 * * *'
    - cron: '0 14 * * *'
    - cron: '0 16 * * *'
    - cron: '0 18 * * *'
    - cron: '0 20 * * *'

jobs:
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    env:
      CONFIG: ${{ secrets.CONFIG }} # your rclone config contents as a secret

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4
      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.

      - name: Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      - name: rclone setup and files
        run: |
          mkdir -p ~/.config/rclone
          echo "$CONFIG" > ~/.config/rclone/rclone.conf
          export RCLONE_CONFIG=~/.config/rclone/rclone.conf
          mkdir -p ~/mnt/storage
          rclone copy gdrive:Youtube ~/mnt/storage --progress -vv
          cd ~/mnt/storage
          rclone serve http gdrive: --addr :8080 --vfs-cache-mode full &
          echo "Waiting 5s for rclone server to start..."
          sleep 5
          pip install google-api-python-client google-auth-oauthlib google-auth requests
          python main.py --privacy-status public --one-per-account
          rclone copy ~/mnt/storage gdrive:Youtube --progress -vv
        env:
          CONFIG: ${{ secrets.CONFIG }}


